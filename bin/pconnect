#!/bin/sh

# exit on any errors:
set -e

DIRNAME=`dirname $0`

if [ $# -lt 1 ]
then
  echo "Usage: $0 @pantheon-alias"
  exit 1
fi

DRUSH='/usr/local/bin/drush'

TEMPLATE=$DIRNAME/spf-template.spf

TMP_SPF='/tmp/tmp.spf'

terminus sites aliases

CONNECTION_STRING=`$DRUSH $1 sql-connect`
DATABASE=`echo $CONNECTION_STRING | sed -e 's/.*--database=\([^\\ ]*\).*/\1/g'`
HOST=`echo $CONNECTION_STRING | sed -e 's/.*--host=\([^\\ ]*\).*/\1/g'`
PORT=`echo $CONNECTION_STRING | sed -e 's/.*--port=\([^\\ ]*\).*/\1/g'`
PASSWORD=`echo $CONNECTION_STRING | sed -e 's/.*--password=\([^\\ ]*\).*/\1/g'`
USER=`echo $CONNECTION_STRING | sed -e 's/.*--user=\([^\\ ]*\).*/\1/g'`

eval "echo \"$(< $TEMPLATE)\"" > $TMP_SPF

open $TMP_SPF
