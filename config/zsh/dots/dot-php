#!/usr/bin/env zsh

# Getting an error with php when we turn on file opcache for cli...
# local OPCACHE_TMP_PATH=/tmp/php/opcache
# mkdir -p $OPCACHE_TMP_PATH
#[Opcache]
#opcache.enable_cli=1
#opcache.file_cache=$OPCACHE_TMP_PATH
#opcache.file_cache_only=1

local PHP_CONF_DIRS=($HOMEBREW_PREFIX/etc/php/7.*/conf.d(N))

if [[ -n $PHP_CONF_DIRS ]] {
    cat > $PHP_CONF_DIRS/zcustom.ini <<-INI
# Generated from Dot
[Date]
date.timezone=America/New_York
INI
    ink -c green "[PHP] Saved Custom Config"
}

if (( $+commands[composer] )) {
    composer global update

    composer global config minimum-stability dev

    ink -l -c green "[composer] Installing cgr"

    (( $+commands[cgr] )) || composer global require consolidation/cgr

    ink -l -c green "[composer] Installing hirak/prestissimo"
    composer global require hirak/prestissimo

    ink -l -c green "[composer] Installing composer packages"
    (( $+commands[drush] )) || cgr --stability dev drush/drush:dev-master
    (( $+commands[terminus] )) || cgr --stability dev pantheon-systems/terminus:dev-master
    (( $+commands[phpmd] )) || cgr phpmd/phpmd

    ink -l -c green "[composer] Updating composer packages"
    cgr update
}
