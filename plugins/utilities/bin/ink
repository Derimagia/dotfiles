#!/usr/bin/env zsh
emulate -L zsh

source $DOTFILES/plugins/colors/colors.vital.zsh

local ink_text=() ink_color='' is_new_line=false ink_effects=()

while getopts c:luibt: opt; do
    case $opt in
        (c)
            ink_color=$OPTARG
            ;;
        (l)
            is_new_line=true
        ;;
        (i)
            ink_effects+=(italic)
        ;;
        (b)
            ink_effects+=(bold)
            ;;
        (u)
            ink_effects+=(underline)
        ;;
        (t)
            if [[ $OPTARG != <-> ]]; then
                print -- "$OPTARG: must be an interger" >&2
                return 1
            fi
            tty="$OPTARG"
            ;;
    esac
done
shift $(( OPTIND - 1 ))

if [[ $* == '-' ]]; then
    while IFS= read -r line; do
        ink_text+=($line) ;
    done
    shift
fi

ink_text+=($*)

for ink_effect in $ink_effects; do
    ink_text="${FX[$ink_effect]}${ink_text}${FX[reset]}"
done

$is_new_line && text_after="\n" || text_after=""

ink_text=${FG[$ink_color]}${ink_text}${FX[reset]}${text_after}

case $tty in
    (2)
        print -- $ink_text >&2
        ;;
    (*)
        print -- $ink_text
        ;;
esac
